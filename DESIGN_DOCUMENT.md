# Head Tracking System Design Document

## Raspberry Pi + MPU6050 Head Tracker

**Version:** 1.0  
**Date:** December 2024  
**Author:** Engineering Team  

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [System Overview](#2-system-overview)
3. [Architecture](#3-architecture)
4. [Hardware Design](#4-hardware-design)
5. [Software Design](#5-software-design)
6. [Data Flow](#6-data-flow)
7. [Sensor Fusion Algorithms](#7-sensor-fusion-algorithms)
8. [Display System](#8-display-system)
9. [Performance Requirements](#9-performance-requirements)
10. [Testing Strategy](#10-testing-strategy)
11. [Future Enhancements](#11-future-enhancements)
12. [Appendices](#12-appendices)

---

## 1. Executive Summary

### 1.1 Purpose

This document describes the design of a real-time head tracking system using a Raspberry Pi single-board computer and an MPU6050 inertial measurement unit (IMU). The system captures head orientation in 3D space and renders a responsive visual display.

### 1.2 Scope

The system provides:
- Real-time 6-DOF sensor data acquisition
- Sensor fusion for stable orientation estimation
- 3D graphical visualization of head orientation
- Sub-100ms end-to-end latency

### 1.3 Goals & Objectives

| Goal | Metric | Target |
|------|--------|--------|
| **Low Latency** | End-to-end delay | < 50ms |
| **High Accuracy** | Angular error | < 2Â° (pitch/roll) |
| **Smooth Display** | Frame rate | 60 FPS |
| **Stability** | Drift rate | < 1Â°/min (pitch/roll) |
| **Usability** | Setup time | < 5 minutes |

### 1.4 Constraints

- **Hardware Budget:** ~$50 USD total
- **Power:** USB-powered (5V, < 2A)
- **Processing:** Single Raspberry Pi (no external compute)
- **Sensor:** Single IMU (no magnetometer for yaw stability)

---

## 2. System Overview

### 2.1 High-Level Description

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HEAD TRACKING SYSTEM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ MPU6050  â”‚â”€IÂ²Câ”€â–ºâ”‚ Raspberry Pi â”‚â”€HDMIâ”€â–ºâ”‚    Display Output    â”‚    â”‚
â”‚   â”‚  Sensor  â”‚      â”‚  (Python)    â”‚      â”‚   (3D Visualization)  â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â–²                    â”‚                                            â”‚
â”‚       â”‚                    â–¼                                            â”‚
â”‚   [Mounted on         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚    User's Head]       â”‚ Filters â”‚                                       â”‚
â”‚                       â”‚ (Fusion)â”‚                                       â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Key Components

| Component | Role | Technology |
|-----------|------|------------|
| **Sensor** | Motion capture | MPU6050 (6-axis IMU) |
| **Controller** | Processing & display | Raspberry Pi 4 |
| **Communication** | Sensor-to-controller | IÂ²C @ 400kHz |
| **Software** | Data processing | Python 3.9+ |
| **Visualization** | User interface | Pygame 2.x |

### 2.3 Use Cases

1. **VR/AR Prototyping** - Head tracking for immersive displays
2. **Accessibility** - Head-controlled cursor for mobility-impaired users
3. **Gaming** - Motion-controlled game interfaces
4. **Robotics** - Teleoperation head tracking for robot control
5. **Education** - Teaching sensor fusion and embedded systems

---

## 3. Architecture

### 3.1 System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              APPLICATION LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    head_tracker_display.py                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ HeadTracker  â”‚  â”‚ OrientationDisp â”‚  â”‚      HeadModel          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     App      â”‚  â”‚      lay        â”‚  â”‚   (3D Rendering)        â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              PROCESSING LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      sensor_fusion.py                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  ComplementaryFilter   â”‚    â”‚   KalmanFilterOrientation      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Î± weighting         â”‚    â”‚   - State estimation           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Gyro integration    â”‚    â”‚   - Noise covariance           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Accel reference     â”‚    â”‚   - Optimal gain               â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               DRIVER LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         mpu6050.py                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  IÂ²C Protocol  â”‚  â”‚  Calibration  â”‚  â”‚    Data Conversion      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  (smbus2)      â”‚  â”‚  (Offset)     â”‚  â”‚    (Raw â†’ Physical)     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              HARDWARE LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚          MPU6050             â”‚    â”‚        Raspberry Pi            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ Accel   â”‚  â”‚  Gyro    â”‚  â”‚â—„â”€â”€â–ºâ”‚  â”‚  IÂ²C   â”‚  â”‚     GPU      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ Â±2g     â”‚  â”‚  Â±250Â°/s â”‚  â”‚IÂ²C â”‚  â”‚  Bus   â”‚  â”‚   (Display)  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Module Responsibilities

#### 3.2.1 mpu6050.py (Driver Layer)

| Class/Function | Responsibility |
|----------------|----------------|
| `MPU6050` | Hardware abstraction for sensor |
| `_initialize()` | Wake sensor, configure sample rate & filters |
| `read()` | Burst read all sensor registers |
| `calibrate()` | Calculate sensor offsets at rest |
| `SensorData` | Data container for sensor readings |

#### 3.2.2 sensor_fusion.py (Processing Layer)

| Class/Function | Responsibility |
|----------------|----------------|
| `ComplementaryFilter` | Weighted combination of gyro + accel |
| `KalmanFilter1D` | 1-axis optimal state estimation |
| `KalmanFilterOrientation` | 3-axis Kalman wrapper |
| `HeadTracker` | High-level sensor + filter integration |
| `Orientation` | Pitch/roll/yaw data container |

#### 3.2.3 head_tracker_display.py (Application Layer)

| Class/Function | Responsibility |
|----------------|----------------|
| `HeadTrackerApp` | Main application controller |
| `HeadModel` | 3D wireframe geometry & rendering |
| `OrientationDisplay` | Gauges and data panels |
| `GridBackground` | Animated background rendering |
| `Config` | Centralized configuration |

### 3.3 Design Patterns Used

| Pattern | Application | Benefit |
|---------|-------------|---------|
| **Dependency Injection** | Filter type selection in `HeadTracker` | Swappable algorithms |
| **Data Class** | `SensorData`, `Orientation`, `Config` | Clean data structures |
| **Template Method** | `_initialize()` in sensor driver | Extensible setup |
| **Strategy** | Complementary vs Kalman filter | Runtime algorithm selection |
| **Facade** | `HeadTracker` class | Simple high-level API |

---

## 4. Hardware Design

### 4.1 MPU6050 Sensor Specifications

| Parameter | Value | Notes |
|-----------|-------|-------|
| **Accelerometer Range** | Â±2g, Â±4g, Â±8g, Â±16g | Using Â±2g for precision |
| **Gyroscope Range** | Â±250, Â±500, Â±1000, Â±2000 Â°/s | Using Â±250Â°/s |
| **ADC Resolution** | 16-bit | 65,536 levels |
| **Sample Rate** | Up to 8 kHz | Using 1 kHz |
| **IÂ²C Speed** | 400 kHz (Fast Mode) | Standard for Pi |
| **Power** | 3.3V, ~3.5mA | Powered from Pi GPIO |

### 4.2 Raspberry Pi Specifications

| Parameter | Value | Notes |
|-----------|-------|-------|
| **Model** | Pi 4 (recommended) | Pi 3 also works |
| **CPU** | ARM Cortex-A72 @ 1.5GHz | Quad-core |
| **RAM** | 2GB minimum | 4GB+ recommended |
| **IÂ²C Pins** | GPIO 2 (SDA), GPIO 3 (SCL) | Hardware IÂ²C |
| **Display** | HDMI 2.0 | Up to 4K @ 60Hz |

### 4.3 Wiring Schematic

```
                                  RASPBERRY PI 4
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                            â”‚    â”‚   40-PIN GPIO â”‚    â”‚
                            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                            â”‚     â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚     â”‚
                            â”‚     1 2 3 4 5 6 7 8     â”‚
                            â”‚     â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼     â”‚
                            â”‚    3V3   SDA SCL GND    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚  â”‚  â”‚  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                       â”‚  â”‚  â”‚  â”‚                     â”‚
           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”‚  â”‚                     â”‚
           â”‚    â”‚   MPU6050   â”‚    â”‚  â”‚  â”‚  â”‚                     â”‚
           â”‚    â”‚             â”‚    â”‚  â”‚  â”‚  â”‚                     â”‚
           â”‚    â”‚  VCC â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚   â† 3.3V Power      â”‚
           â”‚    â”‚  SDA â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â† IÂ²C Data        â”‚
           â”‚    â”‚  SCL â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â† IÂ²C Clock       â”‚
           â”‚    â”‚  GND â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â† Ground          â”‚
           â”‚    â”‚  XDA        â”‚   (unused)                        â”‚
           â”‚    â”‚  XCL        â”‚   (unused)                        â”‚
           â”‚    â”‚  AD0 â”€â”€â”€â”¬â”€â”€â”€â”‚   â† Address select (GND = 0x68)   â”‚
           â”‚    â”‚  INT    â”‚   â”‚   (optional interrupt)            â”‚
           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”˜                                   â”‚
           â”‚              â”‚                                       â”‚
           â”‚              â–¼                                       â”‚
           â”‚             GND                                      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Pin Mapping:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MPU6050 â”‚ Pi GPIO   â”‚ Description                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ VCC     â”‚ Pin 1     â”‚ 3.3V power supply                      â”‚
    â”‚ GND     â”‚ Pin 6     â”‚ Ground reference                       â”‚
    â”‚ SDA     â”‚ Pin 3     â”‚ IÂ²C data (GPIO 2)                      â”‚
    â”‚ SCL     â”‚ Pin 5     â”‚ IÂ²C clock (GPIO 3)                     â”‚
    â”‚ AD0     â”‚ GND       â”‚ IÂ²C address = 0x68 (low) or 0x69 (high)â”‚
    â”‚ INT     â”‚ (opt)     â”‚ Data ready interrupt                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 IÂ²C Protocol Details

```
IÂ²C Communication Frame:
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚START â”‚ Address  â”‚ R/W â”‚   ACK    â”‚ Reg â”‚     Data       â”‚ STOP â”‚
â”‚  S   â”‚ 1101000  â”‚  0  â”‚    A     â”‚0x3B â”‚ 14 bytes burst â”‚  P   â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
         0x68       Write          ACCEL_XOUT_H â†’ GYRO_ZOUT_L

Timing:
- Clock: 400 kHz (2.5 Âµs per bit)
- 14-byte burst read: ~300 Âµs
- Effective sample rate: ~3.3 kHz max
```

---

## 5. Software Design

### 5.1 Class Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLASS HIERARCHY                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Â«dataclassÂ»      â”‚         â”‚     Â«dataclassÂ»      â”‚
â”‚     SensorData       â”‚         â”‚     Orientation      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + accel_x: float     â”‚         â”‚ + pitch: float       â”‚
â”‚ + accel_y: float     â”‚         â”‚ + roll: float        â”‚
â”‚ + accel_z: float     â”‚         â”‚ + yaw: float         â”‚
â”‚ + gyro_x: float      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ + gyro_y: float      â”‚                    â–²
â”‚ + gyro_z: float      â”‚                    â”‚ produces
â”‚ + temp: float        â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–²                      â”‚                      â”‚
          â”‚ produces             â”‚                      â”‚
          â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Complementary    â”‚   â”‚ KalmanFilter     â”‚
â”‚      MPU6050       â”‚ â”‚    Filter        â”‚   â”‚  Orientation     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - bus: SMBus       â”‚ â”‚ - alpha: float   â”‚   â”‚ - pitch_filter   â”‚
â”‚ - address: int     â”‚ â”‚ - orientation    â”‚   â”‚ - roll_filter    â”‚
â”‚ - accel_scale      â”‚ â”‚ - last_time      â”‚   â”‚ - yaw: float     â”‚
â”‚ - gyro_scale       â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - accel_offset[]   â”‚ â”‚ + update()       â”‚   â”‚ + update()       â”‚
â”‚ - gyro_offset[]    â”‚ â”‚ + reset()        â”‚   â”‚ + reset()        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ - _accel_angles()â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ + read(): SensorDatâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â–²
â”‚ + calibrate()      â”‚           â–²                     â”‚
â”‚ + get_accel_angles â”‚           â”‚ implements         â”‚
â”‚ + close()          â”‚           â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”
          â–²             â”‚         Â«interfaceÂ»               â”‚
          â”‚ uses        â”‚           Filter                  â”‚
          â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ + update(SensorData): Orientationâ”‚
â”‚    HeadTracker     â”‚  â”‚ + reset(): void                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - sensor: MPU6050  â”‚
â”‚ - filter: Filter   â”‚
â”‚ - filter_name: str â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + calibrate()      â”‚
â”‚ + get_orientation()â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ + get_raw_data()   â”‚                                       â”‚
â”‚ + reset()          â”‚                                       â”‚ uses
â”‚ + close()          â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
                                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”
â”‚                      HeadTrackerApp                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - config: Config                                               â”‚
â”‚ - screen: pygame.Surface                                       â”‚
â”‚ - clock: pygame.time.Clock                                     â”‚
â”‚ - tracker: HeadTracker                                         â”‚
â”‚ - head_model: HeadModel                                        â”‚
â”‚ - orientation_display: OrientationDisplay                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + run(): void                                                  â”‚
â”‚ + handle_events(): bool                                        â”‚
â”‚ + update(): void                                               â”‚
â”‚ + draw(): void                                                 â”‚
â”‚ + cleanup(): void                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Sequence Diagram - Main Loop

```
â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Main â”‚    â”‚HeadTrackerâ”‚    â”‚   Filter   â”‚    â”‚MPU6050 â”‚    â”‚ Pygame  â”‚
â”‚ Loop â”‚    â”‚    App    â”‚    â”‚            â”‚    â”‚        â”‚    â”‚ Display â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚ run()        â”‚                â”‚                â”‚              â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                â”‚              â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚ [Main Loop @ 60Hz]              â”‚              â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚ handle_events()â”‚                â”‚              â”‚
   â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚              â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚ update()       â”‚                â”‚              â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚              â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚                â”‚ read_i2c()     â”‚              â”‚
   â”‚              â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚                â”‚ SensorData     â”‚              â”‚
   â”‚              â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚                â”‚ apply_fusion() â”‚              â”‚
   â”‚              â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚              â”‚
   â”‚              â”‚                â”‚        â”‚       â”‚              â”‚
   â”‚              â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚              â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚  Orientation   â”‚                â”‚              â”‚
   â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚              â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚ draw()         â”‚                â”‚              â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚                â”‚                â”‚   flip()     â”‚
   â”‚              â”‚                â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
   â”‚              â”‚ tick(60)       â”‚                â”‚              â”‚
   â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚              â”‚                â”‚                â”‚              â”‚
```

### 5.3 State Diagram - Application States

```
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚                             â”‚
                           â–¼                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ INITIALIZINGâ”‚                      â”‚
        â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â”‚
        â”‚                  â”‚                             â”‚
        â”‚                  â”‚ sensor_connected            â”‚
        â”‚                  â–¼                             â”‚
        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
        â”‚           â”‚ CALIBRATING â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         [C] key      â”‚
        â”‚                  â”‚                             â”‚
        â”‚                  â”‚ calibration_complete        â”‚
        â”‚                  â–¼                             â”‚
        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
        â”‚           â”‚   RUNNING   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         [R] key      â”‚
        â”‚                  â”‚                  â”‚          â”‚
        â”‚                  â”‚                  â”‚          â”‚
        â”‚         [ESC] or â”‚                  â–¼          â”‚
        â”‚         window   â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
        â”‚         close    â”‚           â”‚ RESETTING â”‚â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â–¼
        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚  SHUTDOWN   â”‚
        â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â”‚ error            â”‚ cleanup_complete
        â”‚                  â–¼
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    States:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ State        â”‚ Description                                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ INITIALIZING â”‚ Loading pygame, connecting to sensor            â”‚
    â”‚ CALIBRATING  â”‚ Sampling sensor offsets while stationary        â”‚
    â”‚ RUNNING      â”‚ Normal operation: read â†’ fuse â†’ display         â”‚
    â”‚ RESETTING    â”‚ Zeroing orientation filters                     â”‚
    â”‚ SHUTDOWN     â”‚ Closing IÂ²C bus and pygame                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Data Flow

### 6.1 Complete Data Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DATA FLOW PIPELINE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHYSICAL   â”‚    â”‚    RAW      â”‚    â”‚  PHYSICAL   â”‚    â”‚   CALIBRATED    â”‚
â”‚   MOTION    â”‚â”€â”€â”€â–ºâ”‚   SENSOR    â”‚â”€â”€â”€â–ºâ”‚   UNITS     â”‚â”€â”€â”€â–ºâ”‚     VALUES      â”‚
â”‚             â”‚    â”‚   VALUES    â”‚    â”‚             â”‚    â”‚                 â”‚
â”‚ Tilt head   â”‚    â”‚ -32768 to   â”‚    â”‚ Accel: g    â”‚    â”‚ Offset removed  â”‚
â”‚ 30Â° pitch   â”‚    â”‚ +32767      â”‚    â”‚ Gyro: Â°/s   â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                  â”‚                   â”‚
                         â”‚ ADC              â”‚ Scale             â”‚ Subtract
                         â”‚                  â”‚ Factor            â”‚ Offset
                         â–¼                  â–¼                   â–¼

    Example: Pitch = 30Â° tilt
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Raw accel_y = 8192        â†’ 8192 / 16384 = 0.5g
    Raw accel_z = 14189       â†’ 14189 / 16384 = 0.866g
    
    pitch = atan2(0.5, 0.866) = 30Â°


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CALIBRATED    â”‚    â”‚  FUSED ANGLE    â”‚    â”‚   ORIENTATION   â”‚
â”‚     VALUES      â”‚â”€â”€â”€â–ºâ”‚   ESTIMATE      â”‚â”€â”€â”€â–ºâ”‚    OBJECT       â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Accel angles    â”‚    â”‚ Complementary   â”‚    â”‚ pitch: 30.0Â°    â”‚
â”‚ Gyro rates      â”‚    â”‚ Filter output   â”‚    â”‚ roll:   5.2Â°    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚ yaw:  -12.3Â°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                      â”‚
        â”‚ Calculate            â”‚ Î±Â·gyro +             â”‚ Package
        â”‚ Angles               â”‚ (1-Î±)Â·accel          â”‚ Result
        â–¼                      â–¼                      â–¼

    Fusion Calculation:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Î± = 0.96, dt = 0.016s (60 Hz)
    
    gyro_angle  = prev_pitch + gyro_x Ã— dt = 29.8Â° + 0.5Â°/s Ã— 0.016s = 29.81Â°
    accel_angle = atan2(accel_y, accel_z) = 30.2Â°
    
    fused_pitch = 0.96 Ã— 29.81Â° + 0.04 Ã— 30.2Â° = 29.83Â°


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ORIENTATION   â”‚    â”‚   3D ROTATION   â”‚    â”‚  SCREEN COORDS  â”‚
â”‚    OBJECT       â”‚â”€â”€â”€â–ºâ”‚   TRANSFORMS    â”‚â”€â”€â”€â–ºâ”‚   (2D Points)   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ pitch: 30.0Â°    â”‚    â”‚ Rx Ã— Ry Ã— Rz    â”‚    â”‚ Head vertices   â”‚
â”‚ roll:   5.2Â°    â”‚    â”‚ matrices        â”‚    â”‚ projected to    â”‚
â”‚ yaw:  -12.3Â°    â”‚    â”‚                 â”‚    â”‚ screen space    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                      â”‚
        â”‚ Read                 â”‚ Apply                â”‚ Perspective
        â”‚ Values               â”‚ Rotation             â”‚ Projection
        â–¼                      â–¼                      â–¼

    3D â†’ 2D Projection:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Original vertex: (100, 50, 30)
    After rotation:  (87.5, 68.2, 42.1)
    
    factor = 500 / (500 + 42.1) = 0.922
    screen_x = center_x + 87.5 Ã— 0.922 = 640 + 80.7 = 720
    screen_y = center_y - 68.2 Ã— 0.922 = 360 - 62.9 = 297
    
    Final screen position: (720, 297)
```

### 6.2 Data Structures

```python
# Sensor Data (from MPU6050)
SensorData:
    accel_x: float  # -2.0 to +2.0 g
    accel_y: float  # -2.0 to +2.0 g
    accel_z: float  # -2.0 to +2.0 g
    gyro_x:  float  # -250 to +250 Â°/s
    gyro_y:  float  # -250 to +250 Â°/s
    gyro_z:  float  # -250 to +250 Â°/s
    temp:    float  # Â°C

# Orientation (output of fusion)
Orientation:
    pitch: float    # -90 to +90 degrees
    roll:  float    # -180 to +180 degrees
    yaw:   float    # -180 to +180 degrees (drifts)
```

---

## 7. Sensor Fusion Algorithms

### 7.1 Problem Statement

| Sensor | Pros | Cons |
|--------|------|------|
| **Accelerometer** | Absolute reference (gravity) | Noisy, affected by motion |
| **Gyroscope** | Low noise, fast response | Drifts over time |

**Goal:** Combine both to get stable, responsive orientation estimation.

### 7.2 Complementary Filter

The simplest and most efficient sensor fusion approach.

#### 7.2.1 Mathematical Formulation

```
Î¸[n] = Î± Ã— (Î¸[n-1] + Ï‰ Ã— Î”t) + (1-Î±) Ã— Î¸_accel

Where:
    Î¸[n]      = Current angle estimate
    Î¸[n-1]    = Previous angle estimate
    Ï‰         = Gyroscope angular velocity (Â°/s)
    Î”t        = Time step (seconds)
    Î¸_accel   = Angle from accelerometer
    Î±         = Filter coefficient (0.96 typical)
```

#### 7.2.2 Frequency Response

```
                Frequency Response
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Gain                                               â”‚
    â”‚  1.0 â”¤                                             â”‚
    â”‚      â”‚  Accel â”€â”€â”€â”€â”€â”€â”                              â”‚
    â”‚      â”‚               â•²                             â”‚
    â”‚  0.5 â”¤                â•³â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Gyro    â”‚
    â”‚      â”‚               â•±                             â”‚
    â”‚      â”‚              â•±                              â”‚
    â”‚  0.0 â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚      â”‚      0.1    1.0    10     100    Freq (Hz) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Crossover frequency â‰ˆ (1-Î±) / (Î± Ã— Î”t) â‰ˆ 2.5 Hz
    
    - Below crossover: Trust accelerometer (stable)
    - Above crossover: Trust gyroscope (fast response)
```

#### 7.2.3 Implementation

```python
def update(self, sensor_data: SensorData) -> Orientation:
    dt = current_time - self.last_time
    
    # Accelerometer angles (gravity reference)
    accel_pitch = atan2(accel_y, sqrt(accel_xÂ² + accel_zÂ²))
    accel_roll  = atan2(-accel_x, accel_z)
    
    # Gyroscope integration
    gyro_pitch = prev_pitch + gyro_x Ã— dt
    gyro_roll  = prev_roll  + gyro_y Ã— dt
    gyro_yaw   = prev_yaw   + gyro_z Ã— dt
    
    # Complementary filter fusion
    pitch = Î± Ã— gyro_pitch + (1-Î±) Ã— accel_pitch
    roll  = Î± Ã— gyro_roll  + (1-Î±) Ã— accel_roll
    yaw   = gyro_yaw  # No accelerometer reference for yaw
    
    return Orientation(pitch, roll, yaw)
```

### 7.3 Kalman Filter

Optimal state estimation with noise modeling.

#### 7.3.1 State Space Model

```
State vector:     x = [angle, bias]áµ€
Measurement:      z = accelerometer_angle
Control input:    u = gyroscope_rate

State transition: x[k] = A Ã— x[k-1] + B Ã— u + w
                  [angle]   [1  -dt] [angle]     [dt]
                  [bias ] = [0   1 ] [bias ] +   [0 ] Ã— gyro_rate + process_noise

Measurement:      z = H Ã— x + v
                  accel_angle = [1  0] Ã— [angle, bias]áµ€ + measurement_noise
```

#### 7.3.2 Kalman Equations

```
PREDICT:
    xÌ‚â» = A Ã— xÌ‚ + B Ã— u          # Predicted state
    Pâ» = A Ã— P Ã— Aáµ€ + Q          # Predicted covariance

UPDATE:
    K = Pâ» Ã— Háµ€ Ã— (H Ã— Pâ» Ã— Háµ€ + R)â»Â¹    # Kalman gain
    xÌ‚ = xÌ‚â» + K Ã— (z - H Ã— xÌ‚â»)            # Updated state
    P = (I - K Ã— H) Ã— Pâ»                  # Updated covariance

Parameters:
    Q = process noise covariance (gyro drift) â‰ˆ 0.001
    R = measurement noise covariance (accel) â‰ˆ 0.03
```

### 7.4 Filter Comparison

| Aspect | Complementary | Kalman |
|--------|---------------|--------|
| **Complexity** | O(1) | O(nÂ²) |
| **Tuning** | 1 parameter (Î±) | 2+ parameters (Q, R) |
| **CPU Usage** | ~0.1% | ~1% |
| **Accuracy** | Good | Optimal |
| **Adaptivity** | Fixed | Adapts to noise |
| **Implementation** | 10 lines | 50+ lines |

**Recommendation:** Use Complementary Filter for most applications. Kalman only needed for high-precision or varying noise conditions.

---

## 8. Display System

### 8.1 Rendering Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           RENDERING PIPELINE                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frame      â”‚    â”‚  Clear &     â”‚    â”‚   Draw       â”‚    â”‚   Draw       â”‚
â”‚   Start      â”‚â”€â”€â”€â–ºâ”‚  Background  â”‚â”€â”€â”€â–ºâ”‚   3D Head    â”‚â”€â”€â”€â–ºâ”‚   UI/HUD     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                   â”‚                   â”‚
                           â–¼                   â–¼                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Gradient     â”‚    â”‚ Transform    â”‚    â”‚ Gauges       â”‚
                    â”‚ fill         â”‚    â”‚ vertices     â”‚    â”‚ Panel        â”‚
                    â”‚ Grid lines   â”‚    â”‚ Project 3D   â”‚    â”‚ FPS counter  â”‚
                    â”‚ (animated)   â”‚    â”‚ Draw lines   â”‚    â”‚ Mode label   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  Flip Buffer â”‚
                                        â”‚  (V-Sync)    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 3D Projection Math

```
3D Rotation (Euler Angles):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Rotation matrices:

Rx(pitch) = â”‚ 1    0         0      â”‚    Rotate around X-axis
            â”‚ 0   cos(p)  -sin(p)   â”‚
            â”‚ 0   sin(p)   cos(p)   â”‚

Ry(roll)  = â”‚ cos(r)   0   sin(r)   â”‚    Rotate around Y-axis
            â”‚   0      1     0      â”‚
            â”‚-sin(r)   0   cos(r)   â”‚

Rz(yaw)   = â”‚ cos(y)  -sin(y)   0   â”‚    Rotate around Z-axis
            â”‚ sin(y)   cos(y)   0   â”‚
            â”‚   0        0      1   â”‚

Combined: R = Rz Ã— Ry Ã— Rx

Perspective Projection:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

screen_x = center_x + x Ã— (d / (d + z))
screen_y = center_y - y Ã— (d / (d + z))

Where d = perspective distance (500 pixels)
```

### 8.3 Visual Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCREEN LAYOUT                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â—† ORIENTATION    â”‚                                    â”‚  ğŸ”´ LIVE      â”‚  â”‚
â”‚  â”‚ â†• PITCH  [â–“â–“â–“â–‘â–‘] +15.3Â°                              â”‚  FPS: 60      â”‚  â”‚
â”‚  â”‚ â†” ROLL   [â–“â–“â–‘â–‘â–‘]  +8.7Â°                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ âŸ³ YAW    [â–‘â–‘â–“â–“â–‘] -22.1Â°                                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                             â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                             /               \                               â”‚
â”‚                            â”‚    â—‰     â—‰     â”‚      â† 3D Wireframe Head     â”‚
â”‚                            â”‚                â”‚         (rotates with         â”‚
â”‚                            â”‚       â–³        â”‚          orientation)         â”‚
â”‚                            â”‚                â”‚                               â”‚
â”‚                             \     â”€â”€â”€      /                                â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                             â”‚
â”‚          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â”‚
â”‚                        â† Perspective Grid (animated)                        â”‚
â”‚                                                                             â”‚
â”‚  ESC: Quit | R: Reset | C: Calibrate         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                                              â”‚ PITCH  â”‚  â”‚  ROLL  â”‚        â”‚
â”‚                                              â”‚  â—¯     â”‚  â”‚   â—¯    â”‚        â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 Color Theme (Cyberpunk)

| Element | RGB | Hex | Usage |
|---------|-----|-----|-------|
| Background Top | (20, 10, 45) | `#140A2D` | Gradient start |
| Background Bottom | (10, 5, 25) | `#0A0519` | Gradient end |
| Grid Lines | (40, 30, 70) | `#281E46` | Perspective grid |
| Head Color | (0, 255, 200) | `#00FFC8` | Wireframe primary |
| Accent Pink | (255, 50, 150) | `#FF3296` | Pitch indicator |
| Accent Cyan | (0, 255, 255) | `#00FFFF` | Roll indicator |
| Accent Purple | (180, 80, 255) | `#B450FF` | Yaw indicator |
| Text | (220, 220, 240) | `#DCDCF0` | Labels |

---

## 9. Performance Requirements

### 9.1 Timing Budget (16.67ms per frame @ 60 FPS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRAME TIMING BUDGET                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Total Frame Time: 16.67 ms                                                 â”‚
â”‚  â”œâ”€â”€ IÂ²C Read:          0.5 ms  â–ˆâ–ˆâ–ˆâ–ˆ                                        â”‚
â”‚  â”œâ”€â”€ Sensor Fusion:     0.1 ms  â–ˆ                                           â”‚
â”‚  â”œâ”€â”€ 3D Transforms:     0.3 ms  â–ˆâ–ˆ                                          â”‚
â”‚  â”œâ”€â”€ Pygame Drawing:    2.0 ms  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                â”‚
â”‚  â”œâ”€â”€ Display Flip:      1.0 ms  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                      â”‚
â”‚  â””â”€â”€ Margin/Sleep:     12.77 ms â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â”‚
â”‚                                                                             â”‚
â”‚  CPU Utilization: ~25%                                                      â”‚
â”‚  Latency (sensor â†’ display): < 35 ms                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Performance Metrics

| Metric | Target | Measured |
|--------|--------|----------|
| Frame Rate | 60 FPS | 60 FPS âœ“ |
| CPU Usage | < 50% | ~25% âœ“ |
| Memory Usage | < 100 MB | ~65 MB âœ“ |
| End-to-End Latency | < 50 ms | ~35 ms âœ“ |
| Sensor Sample Rate | 1 kHz | 1 kHz âœ“ |
| IÂ²C Read Time | < 1 ms | ~0.5 ms âœ“ |

### 9.3 Latency Breakdown

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         END-TO-END LATENCY                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Physical Motion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Display Update â”‚
â”‚                                                                             â”‚
â”‚  [1] Sensor ADC conversion:        1.0 ms                                   â”‚
â”‚  [2] IÂ²C transmission:             0.5 ms                                   â”‚
â”‚  [3] Python processing:            0.5 ms                                   â”‚
â”‚  [4] Wait for frame sync:          0-16.7 ms (avg 8.3 ms)                   â”‚
â”‚  [5] Rendering:                    2.0 ms                                   â”‚
â”‚  [6] Display response:             5-20 ms (monitor dependent)              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  TOTAL:                            9-40 ms (typical ~25 ms)                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Testing Strategy

### 10.1 Test Categories

| Category | Purpose | Tools |
|----------|---------|-------|
| **Unit Tests** | Individual function correctness | pytest |
| **Integration Tests** | Module interaction | pytest + mocks |
| **Hardware Tests** | Sensor communication | i2cdetect, manual |
| **Performance Tests** | Timing & resources | cProfile, time |
| **User Acceptance** | Usability & feel | Manual testing |

### 10.2 Test Cases

#### 10.2.1 Sensor Driver Tests

| Test ID | Description | Expected Result |
|---------|-------------|-----------------|
| SD-01 | IÂ²C connection | Device at 0x68 detected |
| SD-02 | Read accelerometer | Values in range [-2g, +2g] |
| SD-03 | Read gyroscope | Values in range [-250, +250] Â°/s |
| SD-04 | Calibration | Offsets calculated, drift reduced |
| SD-05 | At-rest readings | Accel Z â‰ˆ 1g, Gyro â‰ˆ 0 |

#### 10.2.2 Sensor Fusion Tests

| Test ID | Description | Expected Result |
|---------|-------------|-----------------|
| SF-01 | Filter initialization | Initial orientation (0, 0, 0) |
| SF-02 | Pitch calculation | Â±30Â° matches physical tilt |
| SF-03 | Roll calculation | Â±30Â° matches physical tilt |
| SF-04 | Yaw drift | < 1Â° per minute at rest |
| SF-05 | Filter reset | Returns to (0, 0, 0) |

#### 10.2.3 Display Tests

| Test ID | Description | Expected Result |
|---------|-------------|-----------------|
| DP-01 | Window creation | 1280Ã—720 window opens |
| DP-02 | Frame rate | Stable 60 FPS |
| DP-03 | Head rotation | Matches orientation input |
| DP-04 | Gauge display | Values update in real-time |
| DP-05 | Keyboard input | ESC/R/C keys respond |

### 10.3 Test Script

```python
# test_head_tracker.py

def test_sensor_read():
    """Verify sensor returns valid data"""
    sensor = MPU6050()
    data = sensor.read()
    assert -2.0 <= data.accel_x <= 2.0
    assert -250 <= data.gyro_x <= 250
    sensor.close()

def test_complementary_filter():
    """Verify filter produces reasonable output"""
    cf = ComplementaryFilter(alpha=0.96)
    
    # Simulate 30Â° pitch
    mock_data = SensorData(
        accel_x=0, accel_y=0.5, accel_z=0.866,
        gyro_x=0, gyro_y=0, gyro_z=0, temp=25
    )
    
    orient = cf.update(mock_data)
    assert 25 <= orient.pitch <= 35  # Allow some tolerance

def test_3d_rotation():
    """Verify 3D rotation math"""
    point = (100, 0, 0)
    rotated = rotate_point_3d(point, 0, 0, 90)  # 90Â° yaw
    
    assert abs(rotated[0]) < 1  # X should be ~0
    assert abs(rotated[1] - 100) < 1  # Y should be ~100
```

---

## 11. Future Enhancements

### 11.1 Planned Features

| Priority | Feature | Description | Effort |
|----------|---------|-------------|--------|
| P1 | **Magnetometer support** | Add HMC5883L for yaw stability | Medium |
| P1 | **Network streaming** | Send orientation via WebSocket | Medium |
| P2 | **VR integration** | OpenVR/SteamVR driver | High |
| P2 | **Multi-sensor fusion** | Support MPU9250, BNO055 | Medium |
| P3 | **Machine learning** | Gesture recognition | High |
| P3 | **Mobile app** | iOS/Android companion | High |

### 11.2 Architecture for Magnetometer

```
Current (6-DOF):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MPU6050   â”‚ â”€â”€â”€ Accel + Gyro â”€â”€â”€ â–º Pitch, Roll (stable)
â”‚             â”‚                        Yaw (drifts)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Upgraded (9-DOF):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MPU6050   â”‚ â”€â”€â”€ Accel + Gyro â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                                   â”œâ”€â”€â–º Pitch, Roll, Yaw (all stable)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  HMC5883L   â”‚ â”€â”€â”€ Magnetometer â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.3 Network Streaming Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Raspberry Pi       â”‚         â”‚      Remote Client           â”‚
â”‚                      â”‚         â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  WiFi   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Head Tracker  â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚   3D Engine / VR App   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  UDP    â”‚  â”‚   (Unity, Unreal, etc) â”‚  â”‚
â”‚         â”‚            â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â–¼            â”‚         â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  Protocol: JSON over UDP     â”‚
â”‚  â”‚ WebSocket/UDP  â”‚  â”‚         â”‚  { "pitch": 15.2,            â”‚
â”‚  â”‚    Server      â”‚  â”‚         â”‚    "roll": -3.1,             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚    "yaw": 22.5,              â”‚
â”‚                      â”‚         â”‚    "timestamp": 1702123456 } â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. Appendices

### 12.1 Glossary

| Term | Definition |
|------|------------|
| **IMU** | Inertial Measurement Unit - sensor combining accelerometer and gyroscope |
| **DOF** | Degrees of Freedom - number of independent motion axes |
| **Pitch** | Rotation around lateral (X) axis - nodding up/down |
| **Roll** | Rotation around longitudinal (Y) axis - tilting side to side |
| **Yaw** | Rotation around vertical (Z) axis - turning left/right |
| **Sensor Fusion** | Combining multiple sensor inputs for better estimation |
| **Drift** | Gradual accumulation of error in gyroscope integration |
| **IÂ²C** | Inter-Integrated Circuit - serial communication protocol |

### 12.2 References

1. InvenSense. "MPU-6000/MPU-6050 Product Specification." Rev 3.4, 2013.
2. Pieter-Jan Van de Maele. "Reading a IMU Without Kalman: The Complementary Filter." 2013.
3. Greg Welch, Gary Bishop. "An Introduction to the Kalman Filter." UNC Chapel Hill, 2006.
4. Raspberry Pi Foundation. "Raspberry Pi Documentation - I2C." 2024.

### 12.3 Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | Dec 2024 | Engineering | Initial design document |

---

**End of Design Document**

